# Validation of a phylogenetic pipeline to examine transmission networks in a Canadian HIV cohort.

Abstract. 

## Getting Started

Custom R scripts were written to extract summary statistics about the topology of the inferred transmission trees and extract inferred person-to-person (P2P) relationships. A custom Python script was written to compare the inferred P2P transmission relationships and infection dates to the clinically known information. These scripts are highly commented and can be easily modified to extract whatever you want from the TransPhylo ctree object. 

### Prerequisites

Required:
R 3.0 and above
Python 2.0 and above

Recommended:
RStudio 1.1 and above
IGraph (required by clusterGen.R, install in RStudio with `install.packages("igraph")`)

## How to Use the Scripts

| Script         | Input  | Output  |
| ------------- |:-------------:| -----:|
| brLenChecker      | TransPhylo ptree object | The row and column of the affected node, ID of the originating node, patient ID of the affected node.
| autoSummary      | TransPhylo ptree object, number of sampled patients, TransPhylo parameters to be customized      | Inferred TransPhylo ctree object, summary statistics in the summary_data dataframe |
| transReport | TransPhylo ctree object, number of sampled patients     | TransPhylo ttree object, inferred transmission relationships and infection dates in a text file |
| predictVSKnown   | NA         | Text file categorizing each inferred transmission relationship and infection date as (in)accurate
| plotCTree        | TransPhylo plotCTree parameters, vectors of nodes corresponding to correct and incorrect transmissions | A phylogenetic tree overlaid with nodes indicating transmission relationships
| clusterGen       | Node and link text files, vector of colours for (un)sampled patients | An acyclic graph representing P2P transmission relationships

### Procedure:

1. brLenChecker is used after TransPhylo makes the ptree object. Though simulated sequences will rarely have this problem, maximum-clade credibility phylogenetic (MCC) trees made from real sequence data may have branches that have zero or negative length. TransPhylo breaks when this happens, so they have to be removed from the Newick MCC tree file by hand. brLenChecker checks the branch lengths of the phylogenetic tree object made by TransPhylo's ptreeFromPhylo and reports the location of the problematic branches. If there were any, the TransPhylo ptree object must be re-made with the cleaned Newick file. 
2. autoSummary automates the process of i) running the TransPhylo inference command, inferTTree, and ii) the extraction of the final tree's summary statistics (for more information, please see (reference publication to be added))
3. transReport automates the process of i) extracting the transmission tree (just the tree nodes corresponding to P2P transmissions) from the ctree, and ii) summarizing these relationships for all sampled patients in a text file.
4. predictVSKnown compares the transReport-generated text file of inferred relationships to a text file containing actual relationships. Please note that the work directory containing the inferred and actual relationship text files is set within predictVSKnown. Sample inferred and actual relationship text files are also available in this repository.
5. (Optional) For visualization of the entire transmission tree, you have the option to use the default TransPhylo plotCTree, the modified plotCTree (in this repository), or clusterGen. The default TransPhylo plotCTree is indicates all patients in the tree with different colours, and they're really pretty. However, this is only visually helpful if there are <30 patients in the tree. Any more patients, and it becomes visually hard to distinguish between the colours and visually identify meaningful clusters in the tree. The modified version of plotCTree has two addition parameters- separate vectors containing the nodes corresponding to correct and incorrect transmissions. Correct transmissions are labeled with a green triangle. Incorrect transmissions are labeled with a red triangle. Transmissions without associated clinical information are indicated by an empty grey box. A tree generated by the modified plotCTree is shown in Figure 1.
6. (Optional) For visualization of transmission clusters identified in step 4 analysis or step 5 visualization, use clusterGen. clusterGen takes node (represents patients) and link (represents transmission relationships with direction) files and generates a coloured graph of the transmission cluster. In its current state, all sampled patients are coloured nodes and unsampled patients are white nodes. A transmission cluster generated by clusterGen is shown in Figure 2. Sample node and link text files are also available in this repository.

(<img src="tobeadded">)
(<img src="tobeadded">)

## Authors

* **Lauren Mak:** Developed and tested the scripts. 
* **Didelot et al.:** Developed and tested the [TransPhylo](https://github.com/xavierdidelot/TransPhylo) program. 

See also the list of contributors (reference publication to be added) who participated in this project.

## MIT Open-Source License

This project is licensed under the MIT License. See the [license.md](license.md) file for details.

## Citations

If you find these scripts helpful in your own transmission analyses, please cite (reference publication to be added). 